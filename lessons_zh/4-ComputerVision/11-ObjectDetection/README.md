# ç›®æ ‡æ£€æµ‹

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¤„ç†çš„å›¾åƒåˆ†ç±»æ¨¡å‹æ¥å—å›¾åƒå¹¶äº§ç”Ÿåˆ†ç±»ç»“æœï¼Œä¾‹å¦‚ MNIST é—®é¢˜ä¸­çš„ç±»åˆ«"æ•°å­—"ã€‚ç„¶è€Œï¼Œåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ä»…æƒ³çŸ¥é“å›¾ç‰‡æç»˜äº†å¯¹è±¡ - æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿç¡®å®šå®ƒä»¬çš„ç²¾ç¡®ä½ç½®ã€‚è¿™æ­£æ˜¯**ç›®æ ‡æ£€æµ‹**çš„è¦ç‚¹ã€‚

## [è¯¾å‰æµ‹éªŒ](https://ff-quizzes.netlify.app/en/ai/quiz/21)

![ç›®æ ‡æ£€æµ‹](images/Screen_Shot_2016-11-17_at_11.14.54_AM.png)

> å›¾ç‰‡æ¥è‡ª [YOLO v2 ç½‘ç«™](https://pjreddie.com/darknet/yolov2/)

## ç›®æ ‡æ£€æµ‹çš„æœ´ç´ æ–¹æ³•

å‡è®¾æˆ‘ä»¬æƒ³åœ¨å›¾ç‰‡ä¸Šæ‰¾åˆ°ä¸€åªçŒ«ï¼Œç›®æ ‡æ£€æµ‹çš„ä¸€ä¸ªéå¸¸æœ´ç´ çš„æ–¹æ³•å¦‚ä¸‹ï¼š

1. å°†å›¾ç‰‡åˆ†è§£ä¸ºå¤šä¸ªå›¾å—
2. å¯¹æ¯ä¸ªå›¾å—è¿è¡Œå›¾åƒåˆ†ç±»ã€‚
3. é‚£äº›äº§ç”Ÿè¶³å¤Ÿé«˜æ¿€æ´»çš„å›¾å—å¯ä»¥è¢«è®¤ä¸ºåŒ…å«æ‰€è®¨è®ºçš„å¯¹è±¡ã€‚

![æœ´ç´ ç›®æ ‡æ£€æµ‹](images/naive-detection.png)

> *å›¾ç‰‡æ¥è‡ª[ç»ƒä¹ ç¬”è®°æœ¬](ObjectDetection-TF.ipynb)*

ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•è¿œéç†æƒ³ï¼Œå› ä¸ºå®ƒåªå…è®¸ç®—æ³•éå¸¸ä¸ç²¾ç¡®åœ°å®šä½å¯¹è±¡çš„è¾¹ç•Œæ¡†ã€‚ä¸ºäº†æ›´ç²¾ç¡®çš„ä½ç½®ï¼Œæˆ‘ä»¬éœ€è¦è¿è¡ŒæŸç§**å›å½’**æ¥é¢„æµ‹è¾¹ç•Œæ¡†çš„åæ ‡ - ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç‰¹å®šçš„æ•°æ®é›†ã€‚

## ç›®æ ‡æ£€æµ‹çš„å›å½’

[è¿™ç¯‡åšå®¢æ–‡ç« ](https://towardsdatascience.com/object-detection-with-neural-networks-a4e2c46b4491) å¯¹æ£€æµ‹å½¢çŠ¶æœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ¸©å’Œä»‹ç»ã€‚

## ç›®æ ‡æ£€æµ‹çš„æ•°æ®é›†

æ‚¨å¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹æ•°æ®é›†ç”¨äºæ­¤ä»»åŠ¡ï¼š

* [PASCAL VOC](http://host.robots.ox.ac.uk/pascal/VOC/) - 20 ä¸ªç±»åˆ«
* [COCO](http://cocodataset.org/#home) - ä¸Šä¸‹æ–‡ä¸­çš„å¸¸è§å¯¹è±¡ã€‚80 ä¸ªç±»åˆ«ï¼Œè¾¹ç•Œæ¡†å’Œåˆ†å‰²æ©ç 

![COCO](images/coco-examples.jpg)

## ç›®æ ‡æ£€æµ‹æŒ‡æ ‡

### äº¤å¹¶æ¯”

è™½ç„¶å¯¹äºå›¾åƒåˆ†ç±»å¾ˆå®¹æ˜“è¡¡é‡ç®—æ³•çš„è¡¨ç°å¦‚ä½•ï¼Œä½†å¯¹äºç›®æ ‡æ£€æµ‹ï¼Œæˆ‘ä»¬éœ€è¦è¡¡é‡ç±»åˆ«çš„æ­£ç¡®æ€§ä»¥åŠæ¨æ–­çš„è¾¹ç•Œæ¡†ä½ç½®çš„ç²¾åº¦ã€‚å¯¹äºåè€…ï¼Œæˆ‘ä»¬ä½¿ç”¨æ‰€è°“çš„**äº¤å¹¶æ¯”**ï¼ˆIoUï¼‰ï¼Œå®ƒè¡¡é‡ä¸¤ä¸ªæ¡†ï¼ˆæˆ–ä¸¤ä¸ªä»»æ„åŒºåŸŸï¼‰çš„é‡å ç¨‹åº¦ã€‚

![IoU](images/iou_equation.png)

> *å›¾ 2 æ¥è‡ª[è¿™ç¯‡å…³äº IoU çš„ä¼˜ç§€åšå®¢æ–‡ç« ](https://pyimagesearch.com/2016/11/07/intersection-over-union-iou-for-object-detection/)*

è¿™ä¸ªæƒ³æ³•å¾ˆç®€å• - æˆ‘ä»¬å°†ä¸¤ä¸ªå›¾å½¢ä¹‹é—´çš„äº¤é›†é¢ç§¯é™¤ä»¥å®ƒä»¬çš„å¹¶é›†é¢ç§¯ã€‚å¯¹äºä¸¤ä¸ªç›¸åŒçš„åŒºåŸŸï¼ŒIoU å°†æ˜¯ 1ï¼Œè€Œå¯¹äºå®Œå…¨ä¸ç›¸äº¤çš„åŒºåŸŸï¼Œå®ƒå°†æ˜¯ 0ã€‚å¦åˆ™å®ƒå°†åœ¨ 0 åˆ° 1 ä¹‹é—´å˜åŒ–ã€‚æˆ‘ä»¬é€šå¸¸åªè€ƒè™‘ IoU è¶…è¿‡æŸä¸ªå€¼çš„è¾¹ç•Œæ¡†ã€‚

### å¹³å‡ç²¾åº¦

å‡è®¾æˆ‘ä»¬æƒ³è¡¡é‡ç»™å®šå¯¹è±¡ç±»åˆ« $C$ çš„è¯†åˆ«ç¨‹åº¦ã€‚ä¸ºäº†è¡¡é‡å®ƒï¼Œæˆ‘ä»¬ä½¿ç”¨**å¹³å‡ç²¾åº¦**æŒ‡æ ‡ï¼Œè®¡ç®—å¦‚ä¸‹ï¼š

1. è€ƒè™‘ç²¾ç¡®ç‡-å¬å›ç‡æ›²çº¿æ˜¾ç¤ºå–å†³äºæ£€æµ‹é˜ˆå€¼å€¼ï¼ˆä» 0 åˆ° 1ï¼‰çš„å‡†ç¡®ç‡ã€‚
2. æ ¹æ®é˜ˆå€¼ï¼Œæˆ‘ä»¬å°†åœ¨å›¾åƒä¸­æ£€æµ‹åˆ°æˆ–å¤šæˆ–å°‘çš„ç›®æ ‡ï¼Œä»¥åŠä¸åŒçš„ç²¾ç¡®ç‡å’Œå¬å›ç‡å€¼ã€‚
3. æ›²çº¿å°†å¦‚ä¸‹æ‰€ç¤ºï¼š

<img src="https://github.com/shwars/NeuroWorkshop/raw/master/images/ObjDetectionPrecisionRecall.png"/>

> *å›¾ç‰‡æ¥è‡ª [NeuroWorkshop](http://github.com/shwars/NeuroWorkshop)*

ç»™å®šç±»åˆ« $C$ çš„å¹³å‡ç²¾åº¦æ˜¯æ­¤æ›²çº¿ä¸‹çš„é¢ç§¯ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œå¬å›è½´é€šå¸¸åˆ†ä¸º 10 éƒ¨åˆ†ï¼Œç²¾ç¡®ç‡åœ¨æ‰€æœ‰è¿™äº›ç‚¹ä¸Šå¹³å‡ï¼š

$$
AP = {1\over11}\sum_{i=0}^{10}\mbox{Precision}(\mbox{Recall}={i\over10})
$$

### AP å’Œ IoU

æˆ‘ä»¬åªè€ƒè™‘é‚£äº›æ£€æµ‹ï¼Œå…¶ä¸­ IoU è¶…è¿‡æŸä¸ªå€¼ã€‚ä¾‹å¦‚ï¼Œåœ¨ PASCAL VOC æ•°æ®é›†ä¸­ï¼Œé€šå¸¸å‡è®¾ $\mbox{IoU Threshold} = 0.5$ï¼Œè€Œåœ¨ COCO ä¸­ï¼ŒAP æ˜¯é’ˆå¯¹ $\mbox{IoU Threshold}$ çš„ä¸åŒå€¼æµ‹é‡çš„ã€‚

<img src="https://github.com/shwars/NeuroWorkshop/raw/master/images/ObjDetectionPrecisionRecallIoU.png"/>

> *å›¾ç‰‡æ¥è‡ª [NeuroWorkshop](http://github.com/shwars/NeuroWorkshop)*

### å¹³å‡ç²¾åº¦å‡å€¼ - mAP

ç›®æ ‡æ£€æµ‹çš„ä¸»è¦æŒ‡æ ‡ç§°ä¸º**å¹³å‡ç²¾åº¦å‡å€¼**ï¼Œæˆ–**mAP**ã€‚å®ƒæ˜¯å¹³å‡ç²¾åº¦çš„å€¼ï¼Œåœ¨æ‰€æœ‰å¯¹è±¡ç±»åˆ«ä¸Šå¹³å‡ï¼Œæœ‰æ—¶ä¹Ÿåœ¨ $\mbox{IoU Threshold}$ ä¸Šå¹³å‡ã€‚æ›´è¯¦ç»†åœ°ï¼Œè®¡ç®— **mAP** çš„è¿‡ç¨‹åœ¨[è¿™ç¯‡åšå®¢æ–‡ç« ](https://medium.com/@timothycarlen/understanding-the-map-evaluation-metric-for-object-detection-a07fe6962cf3))ä¸­æè¿°ï¼Œä¹Ÿåœ¨[è¿™é‡Œä½¿ç”¨ä»£ç ç¤ºä¾‹](https://gist.github.com/tarlen5/008809c3decf19313de216b9208f3734)ã€‚

## ä¸åŒçš„ç›®æ ‡æ£€æµ‹æ–¹æ³•

ç›®æ ‡æ£€æµ‹ç®—æ³•æœ‰ä¸¤ä¸ªå¤§ç±»ï¼š

* **åŒºåŸŸæè®®ç½‘ç»œ**ï¼ˆR-CNNã€Fast R-CNNã€Faster R-CNNï¼‰ã€‚ä¸»è¦æ€æƒ³æ˜¯ç”Ÿæˆ**æ„Ÿå…´è¶£åŒºåŸŸ**ï¼ˆROIï¼‰å¹¶åœ¨å®ƒä»¬ä¸Šè¿è¡Œ CNNï¼Œå¯»æ‰¾æœ€å¤§æ¿€æ´»ã€‚å®ƒä¸æœ´ç´ æ–¹æ³•æœ‰ç‚¹ç›¸ä¼¼ï¼Œé™¤äº† ROI æ˜¯ä»¥æ›´èªæ˜çš„æ–¹å¼ç”Ÿæˆçš„ã€‚è¿™ç§æ–¹æ³•çš„ä¸»è¦ç¼ºç‚¹ä¹‹ä¸€æ˜¯å®ƒä»¬å¾ˆæ…¢ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨å›¾åƒä¸Šå¤šæ¬¡é€šè¿‡ CNN åˆ†ç±»å™¨ã€‚
* **å•æ¬¡**ï¼ˆYOLOã€SSDã€RetinaNetï¼‰æ–¹æ³•ã€‚åœ¨è¿™äº›æ¶æ„ä¸­ï¼Œæˆ‘ä»¬è®¾è®¡ç½‘ç»œä»¥åœ¨ä¸€æ¬¡é€šè¿‡ä¸­é¢„æµ‹ç±»åˆ«å’Œ ROIã€‚

### R-CNNï¼šåŸºäºåŒºåŸŸçš„ CNN

[R-CNN](http://islab.ulsan.ac.kr/files/announcement/513/rcnn_pami.pdf) ä½¿ç”¨[é€‰æ‹©æ€§æœç´¢](http://www.huppelen.nl/publications/selectiveSearchDraft.pdf)ç”Ÿæˆ ROI åŒºåŸŸçš„åˆ†å±‚ç»“æ„ï¼Œç„¶åé€šè¿‡ CNN ç‰¹å¾æå–å™¨å’Œ SVM åˆ†ç±»å™¨æ¥ç¡®å®šå¯¹è±¡ç±»åˆ«ï¼Œå¹¶ä½¿ç”¨çº¿æ€§å›å½’æ¥ç¡®å®š*è¾¹ç•Œæ¡†*åæ ‡ã€‚[å®˜æ–¹è®ºæ–‡](https://arxiv.org/pdf/1506.01497v1.pdf)

![RCNN](images/rcnn1.png)

> *å›¾ç‰‡æ¥è‡ª van de Sande et al. ICCV'11*

![RCNN-1](images/rcnn2.png)

> *å›¾ç‰‡æ¥è‡ª[è¿™ç¯‡åšå®¢](https://towardsdatascience.com/r-cnn-fast-r-cnn-faster-r-cnn-yolo-object-detection-algorithms-36d53571365e)

### F-RCNN - Fast R-CNN

è¿™ç§æ–¹æ³•ç±»ä¼¼äº R-CNNï¼Œä½†åœ¨åº”ç”¨å·ç§¯å±‚ä¹‹åå®šä¹‰åŒºåŸŸã€‚

![FRCNN](images/f-rcnn.png)

> å›¾ç‰‡æ¥è‡ª[å®˜æ–¹è®ºæ–‡](https://www.cv-foundation.org/openaccess/content_iccv_2015/papers/Girshick_Fast_R-CNN_ICCV_2015_paper.pdf)ï¼Œ[arXiv](https://arxiv.org/pdf/1504.08083.pdf)ï¼Œ2015

### Faster R-CNN

è¿™ç§æ–¹æ³•çš„ä¸»è¦æ€æƒ³æ˜¯ä½¿ç”¨ç¥ç»ç½‘ç»œæ¥é¢„æµ‹ ROI - æ‰€è°“çš„*åŒºåŸŸæè®®ç½‘ç»œ*ã€‚[è®ºæ–‡](https://arxiv.org/pdf/1506.01497.pdf)ï¼Œ2016

![FasterRCNN](images/faster-rcnn.png)

> å›¾ç‰‡æ¥è‡ª[å®˜æ–¹è®ºæ–‡](https://arxiv.org/pdf/1506.01497.pdf)

### R-FCNï¼šåŸºäºåŒºåŸŸçš„å…¨å·ç§¯ç½‘ç»œ

è¯¥ç®—æ³•ç”šè‡³æ¯” Faster R-CNN æ›´å¿«ã€‚ä¸»è¦æ€æƒ³å¦‚ä¸‹ï¼š

1. æˆ‘ä»¬ä½¿ç”¨ ResNet-101 æå–ç‰¹å¾
1. ç‰¹å¾ç”±**ä½ç½®æ•æ„Ÿåˆ†æ•°å›¾**å¤„ç†ã€‚æ¥è‡ª $C$ ç±»çš„æ¯ä¸ªå¯¹è±¡è¢« $k\times k$ åŒºåŸŸåˆ’åˆ†ï¼Œæˆ‘ä»¬è®­ç»ƒä»¥é¢„æµ‹å¯¹è±¡çš„éƒ¨åˆ†ã€‚
1. å¯¹äºæ¥è‡ª $k\times k$ åŒºåŸŸçš„æ¯ä¸ªéƒ¨åˆ†ï¼Œæ‰€æœ‰ç½‘ç»œå¯¹å¯¹è±¡ç±»åˆ«è¿›è¡ŒæŠ•ç¥¨ï¼Œå¹¶é€‰æ‹©å…·æœ‰æœ€å¤§æŠ•ç¥¨çš„å¯¹è±¡ç±»åˆ«ã€‚

![r-fcn image](images/r-fcn.png)

> å›¾ç‰‡æ¥è‡ª[å®˜æ–¹è®ºæ–‡](https://arxiv.org/abs/1605.06409)

### YOLO - You Only Look Once

YOLO æ˜¯ä¸€ä¸ªå®æ—¶å•æ¬¡ç®—æ³•ã€‚ä¸»è¦æ€æƒ³å¦‚ä¸‹ï¼š

 * å›¾åƒè¢«åˆ†ä¸º $S\times S$ åŒºåŸŸ
 * å¯¹äºæ¯ä¸ªåŒºåŸŸï¼Œ**CNN** é¢„æµ‹ $n$ ä¸ªå¯èƒ½çš„ç›®æ ‡ã€*è¾¹ç•Œæ¡†*åæ ‡å’Œ*ç½®ä¿¡åº¦*=*æ¦‚ç‡* * IoUã€‚

 ![YOLO](images/yolo.png)

> å›¾ç‰‡æ¥è‡ª[å®˜æ–¹è®ºæ–‡](https://arxiv.org/abs/1506.02640)

### å…¶ä»–ç®—æ³•

* RetinaNetï¼š[å®˜æ–¹è®ºæ–‡](https://arxiv.org/abs/1708.02002)
   - [Torchvision ä¸­çš„ PyTorch å®ç°](https://pytorch.org/vision/stable/_modules/torchvision/models/detection/retinanet.html)
   - [Keras å®ç°](https://github.com/fizyr/keras-retinanet)
   - [ä½¿ç”¨ RetinaNet è¿›è¡Œç›®æ ‡æ£€æµ‹](https://keras.io/examples/vision/retinanet/) åœ¨ Keras ç¤ºä¾‹ä¸­
* SSDï¼ˆå•æ¬¡æ£€æµ‹å™¨ï¼‰ï¼š[å®˜æ–¹è®ºæ–‡](https://arxiv.org/abs/1512.02325)

## âœï¸ ç»ƒä¹ ï¼šç›®æ ‡æ£€æµ‹

åœ¨ä»¥ä¸‹ç¬”è®°æœ¬ä¸­ç»§ç»­å­¦ä¹ ï¼š

[ObjectDetection.ipynb](ObjectDetection.ipynb)

## ç»“è®º

åœ¨æœ¬è¯¾ä¸­ï¼Œæ‚¨å¿«é€Ÿæµè§ˆäº†å¯ä»¥å®Œæˆç›®æ ‡æ£€æµ‹çš„æ‰€æœ‰å„ç§æ–¹å¼ï¼

## ğŸš€ æŒ‘æˆ˜

é˜…è¯»è¿™äº›å…³äº YOLO çš„æ–‡ç« å’Œç¬”è®°æœ¬ï¼Œå¹¶äº²è‡ªå°è¯•å®ƒä»¬

* [æè¿° YOLO çš„ä¼˜ç§€åšå®¢æ–‡ç« ](https://www.analyticsvidhya.com/blog/2018/12/practical-guide-object-detection-yolo-framewor-python/)
 * [å®˜æ–¹ç½‘ç«™](https://pjreddie.com/darknet/yolo/)
 * Yoloï¼š[Keras å®ç°](https://github.com/experiencor/keras-yolo2)ï¼Œ[é€æ­¥ç¬”è®°æœ¬](https://github.com/experiencor/basic-yolo-keras/blob/master/Yolo%20Step-by-Step.ipynb)
 * Yolo v2ï¼š[Keras å®ç°](https://github.com/experiencor/keras-yolo2)ï¼Œ[é€æ­¥ç¬”è®°æœ¬](https://github.com/experiencor/keras-yolo2/blob/master/Yolo%20Step-by-Step.ipynb)

## [è¯¾åæµ‹éªŒ](https://ff-quizzes.netlify.app/en/ai/quiz/22)

## å¤ä¹ ä¸è‡ªä¸»å­¦ä¹ 

* [ç›®æ ‡æ£€æµ‹](https://tjmachinelearning.com/lectures/1718/obj/) ç”± Nikhil Sardana
* [ç›®æ ‡æ£€æµ‹ç®—æ³•çš„è‰¯å¥½æ¯”è¾ƒ](https://lilianweng.github.io/lil-log/2018/12/27/object-detection-part-4.html)
* [ç›®æ ‡æ£€æµ‹æ·±åº¦å­¦ä¹ ç®—æ³•å›é¡¾](https://medium.com/comet-app/review-of-deep-learning-algorithms-for-object-detection-c1f3d437b852)
* [åŸºæœ¬ç›®æ ‡æ£€æµ‹ç®—æ³•çš„é€æ­¥ä»‹ç»](https://www.analyticsvidhya.com/blog/2018/10/a-step-by-step-introduction-to-the-basic-object-detection-algorithms-part-1/)
* [åœ¨ Python ä¸­å®ç° Faster R-CNN è¿›è¡Œç›®æ ‡æ£€æµ‹](https://www.analyticsvidhya.com/blog/2018/11/implementation-faster-r-cnn-python-object-detection/)

## [ä½œä¸šï¼šç›®æ ‡æ£€æµ‹](lab/README.md)

